extends layout

block content
  h2= title
  
  div(style="margin-bottom: 20px;")
    p
      strong Transaction ID: 
      span#transaction-id= transaction_id
  
  div#loading(style="padding: 20px; text-align: center;")
    | Loading transaction details...
  
  div#error(style="display: none; padding: 20px; background-color: #ffebee; border-radius: 4px; margin-bottom: 20px;")
    strong Error: 
    span#error-message
  
  div#transaction-container(style="display: none;")
    h3 Transaction Details:
    pre#transaction-data(style="background-color: #f5f5f5; padding: 15px; border-radius: 4px; overflow-x: auto;")
  
  script.
    const transactionId = '#{transaction_id}';
    
    if (!transactionId) {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').style.display = 'block';
      document.getElementById('error-message').textContent = 'No transaction ID provided';
    } else {
      // Fetch transaction details
      fetch(`/proxy/get_transaction?transaction_id=${encodeURIComponent(transactionId)}`)
        .then(response => {
          if (!response.ok) {
            return response.json().then(err => {
              throw new Error(err.message || err.error || 'Failed to fetch transaction');
            });
          }
          return response.json();
        })
        .then(data => {
          document.getElementById('loading').style.display = 'none';
          document.getElementById('transaction-container').style.display = 'block';
          document.getElementById('transaction-data').textContent = JSON.stringify(data, null, 2);
        })
        .catch(error => {
          console.error('Error:', error);
          document.getElementById('loading').style.display = 'none';
          document.getElementById('error').style.display = 'block';
          document.getElementById('error-message').textContent = error.message;
        });
    }
