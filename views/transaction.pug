extends layout

include mixins/card

block content
  .container-fluid
    .d-flex.align-items-center.justify-content-between.mb-3
      h2.mb-0= title
      span.badge.text-bg-secondary.small#sse-status(title="Event stream status")
        i.bi.bi-wifi-off

    script.
      // Update SSE connection indicator
      if (window.SSEManager) {
        SSEManager.onStatusChange(function(status) {
          var badge = document.getElementById('sse-status');
          if (!badge) return;

          badge.classList.remove('text-bg-secondary', 'text-bg-success', 'text-bg-warning');

          // Clear and rebuild badge content safely
          while (badge.firstChild) {
            badge.removeChild(badge.firstChild);
          }

          var icon = document.createElement('i');
          var text = document.createTextNode(' ');

          if (status === 'connected') {
            badge.classList.add('text-bg-success');
            icon.className = 'bi bi-wifi';
            badge.appendChild(icon);
            badge.appendChild(text);
            badge.appendChild(document.createTextNode('Events active'));
          } else if (status === 'connecting') {
            badge.classList.add('text-bg-warning');
            icon.className = 'bi bi-wifi';
            badge.appendChild(icon);
            badge.appendChild(text);
            badge.appendChild(document.createTextNode('Connecting...'));
          } else {
            badge.classList.add('text-bg-secondary');
            icon.className = 'bi bi-wifi-off';
            badge.appendChild(icon);
            badge.appendChild(text);
            badge.appendChild(document.createTextNode('Disconnected'));
          }
        });
      }

    //- Transaction ID Input Form
    .card.mb-3
      +cardHeaderSimple('Transaction ID')
      .card-body
        form#transaction-form
          .input-group
            input#transaction-id-input.form-control.font-monospace(
              type="text"
              placeholder="Enter transaction ID"
              value=transaction_id
            )
            button.btn.btn-primary(type="submit") Lookup

    //- Loading State
    #loading.text-center.p-4(style="display: none;" role="status" aria-live="polite" aria-label="Loading transaction details")
      .spinner-border.text-primary.mb-2(role="status" aria-hidden="true")
        span.visually-hidden Loading...
      p.text-muted Loading transaction details...

    //- Error State
    #error.alert.alert-danger(style="display: none;" role="alert" aria-live="assertive")
      strong Error:
      span#error-message

    //- Transaction Data
    .card#transaction-container(style="display: none;")
      +cardHeaderSimple('Transaction Details')
      .card-body.p-0
        pre#transaction-data.m-0.p-3.font-monospace.small.event-details

    //- Input Coins Section
    .card#input-coins-container.mt-3(style="display: none;")
      +cardHeaderSimple('Input Coins')
      .card-body.p-0
        //- Loading State
        #input-coins-loading.text-center.p-4(style="display: none;" role="status" aria-live="polite" aria-label="Loading input coins")
          .spinner-border.spinner-border-sm.text-primary.mb-2(role="status" aria-hidden="true")
            span.visually-hidden Loading...
          p.text-muted.small Loading input coins...
        //- Error State
        #input-coins-error.alert.alert-danger.m-3(style="display: none;" role="alert" aria-live="assertive")
          strong Error:
          span#input-coins-error-message
        //- Data
        pre#input-coins-data.m-0.p-3.font-monospace.small.event-details

    //- Output Coins Section
    .card#output-coins-container.mt-3(style="display: none;")
      +cardHeaderSimple('Output Coins')
      .card-body.p-0
        //- Loading State
        #output-coins-loading.text-center.p-4(style="display: none;" role="status" aria-live="polite" aria-label="Loading output coins")
          .spinner-border.spinner-border-sm.text-primary.mb-2(role="status" aria-hidden="true")
            span.visually-hidden Loading...
          p.text-muted.small Loading output coins...
        //- Error State
        #output-coins-error.alert.alert-danger.m-3(style="display: none;" role="alert" aria-live="assertive")
          strong Error:
          span#output-coins-error-message
        //- Data
        pre#output-coins-data.m-0.p-3.font-monospace.small.event-details

  script(src='/javascripts/pages/transaction.js')
