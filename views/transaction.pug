extends layout

include mixins/card

block content
  .container-fluid
    h2.mb-3= title

    //- Transaction ID Display
    .card.mb-3
      +cardHeaderSimple('Transaction ID')
      .card-body
        code#transaction-id.fs-5= transaction_id

    //- Loading State
    #loading.text-center.p-4
      .spinner-border.text-primary.mb-2(role="status")
        span.visually-hidden Loading...
      p.text-muted Loading transaction details...

    //- Error State
    #error.alert.alert-danger(style="display: none;")
      strong Error:
      span#error-message

    //- Transaction Data
    .card#transaction-container(style="display: none;")
      +cardHeaderSimple('Transaction Details')
      .card-body.p-0
        pre#transaction-data.m-0.p-3.font-monospace.small(style="background-color: var(--bs-body-bg); overflow-x: auto;")

  script.
    (function() {
      const transactionId = '#{transaction_id}';
      const $loading = document.getElementById('loading');
      const $error = document.getElementById('error');
      const $errorMessage = document.getElementById('error-message');
      const $container = document.getElementById('transaction-container');
      const $data = document.getElementById('transaction-data');

      function showError(message) {
        $loading.style.display = 'none';
        $error.style.display = 'block';
        $errorMessage.textContent = message;
      }

      function showData(data) {
        $loading.style.display = 'none';
        $container.style.display = 'block';
        $data.textContent = JSON.stringify(data, null, 2);
      }

      if (!transactionId) {
        showError('No transaction ID provided');
        return;
      }

      fetch('/proxy/get_transaction?transaction_id=' + encodeURIComponent(transactionId))
        .then(function(response) {
          if (!response.ok) {
            return response.json().then(function(err) {
              throw new Error(err.message || err.error || 'Failed to fetch transaction');
            });
          }
          return response.json();
        })
        .then(showData)
        .catch(function(error) {
          console.error('Error:', error);
          showError(error.message);
        });
    })();
