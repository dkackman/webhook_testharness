extends layout

block content
  .container-fluid
    //- Header with status indicators
    .d-flex.align-items-center.justify-content-between.mb-3
      .d-flex.align-items-center.gap-3
        h4.mb-0= title
        span.badge.text-bg-secondary#webhook-status Not registered
        span.badge#connection-status.text-bg-warning
          span.spinner-grow.spinner-grow-sm.me-1(role="status")
          | Connecting...

      .d-flex.gap-2.align-items-center
        span#event-counter.text-muted.small 0 events
        button.btn.btn-sm.btn-outline-secondary#pause-btn(type="button" title="Pause event capture")
          i.bi.bi-pause-fill
        button.btn.btn-sm.btn-outline-secondary(type="button" onclick="WebhookApp.clearEvents()" title="Clear events") Clear
        //- Event storage dropdown
        .dropdown
          button.btn.btn-sm.btn-outline-secondary.dropdown-toggle(type="button" data-bs-toggle="dropdown" aria-expanded="false" title="Event storage options")
            i.bi.bi-database
          ul.dropdown-menu.dropdown-menu-end
            li
              a.dropdown-item(href="#" onclick="WebhookApp.exportEvents(); return false;")
                i.bi.bi-download.me-2
                | Export Events
            li
              a.dropdown-item(href="#" onclick="WebhookApp.getStorageStats(); return false;")
                i.bi.bi-info-circle.me-2
                | Storage Stats (Console)
            li
              hr.dropdown-divider
            li
              h6.dropdown-header Event Persistence
            li
              span.dropdown-item-text.small.text-muted
                | Max: 100 events (FIFO)
                br
                | Auto-saved to localStorage

    //- Collapsible Setup Panel
    .card.mb-3#setup-panel
      .card-header.d-flex.align-items-center.justify-content-between(
        style="cursor: pointer"
        data-bs-toggle="collapse"
        data-bs-target="#setup-body"
        aria-expanded="true"
      )
        .d-flex.align-items-center.gap-2
          span.fw-semibold Webhook Setup
          span.badge.text-bg-secondary#hmac-badge HMAC: Off
        .d-flex.align-items-center.gap-2
          span#webhook-url.text-muted.small.d-none
          i.bi.bi-chevron-down.transition-transform#setup-chevron

      #setup-body.collapse.show
        .card-body
          .row.g-3
            .col-md-6
              label.form-label.small.fw-semibold(for="secret-input") Webhook Secret
              .input-group
                input#secret-input.form-control.form-control-sm.font-monospace(
                  type="text"
                  placeholder="Optional HMAC-SHA256 secret"
                )
                button.btn.btn-sm.btn-outline-secondary#toggle-secret(type="button" title="Toggle visibility")
                  i.bi.bi-eye

              .form-text If provided, incoming webhooks will be verified with HMAC-SHA256.

            .col-md-6
              label.form-label.small.fw-semibold Webhook URL
              .input-group
                input.form-control.form-control-sm.font-monospace(
                  type="text"
                  value="http://localhost:3000/sage_hook"
                  readonly
                  id="hook-url"
                )
                button.btn.btn-sm.btn-outline-secondary(type="button" onclick="WebhookApp.copyUrl()" title="Copy URL")
                  i.bi.bi-clipboard

          .d-flex.justify-content-between.align-items-center.mt-3
            .d-flex.gap-2
              button#register-btn.btn.btn-primary.btn-sm(type="button" onclick="WebhookApp.register()") Register Webhook
              button#unregister-btn.btn.btn-outline-danger.btn-sm(type="button" onclick="WebhookApp.unregister()" style="display: none;") Unregister

            pre#response-status.mb-0.small.text-muted.text-end Ready

    //- Event Stream (main focus)
    .card
      .card-header.d-flex.align-items-center.justify-content-between.py-2
        .d-flex.align-items-center.gap-2
          span.fw-semibold Live Events
        .d-flex.gap-1
          button.btn.btn-sm.px-2.py-0.filter-btn.active(data-filter="all" title="All events") All
          button.btn.btn-sm.px-2.py-0.filter-btn(data-filter="webhook" title="Webhook events only") Webhooks
          button.btn.btn-sm.px-2.py-0.filter-btn(data-filter="system" title="System messages only") System

      #webhook-events.event-stream
        .event-placeholder.text-center.text-muted.py-5
          i.bi.bi-inbox.d-block.fs-1.mb-2
          | Waiting for webhook events...
          br
          small Register a webhook to start receiving events.

  //- Bootstrap Icons
  link(rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css")

  //- Bootstrap JS for collapse
  script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js")

  script(src='/javascripts/app.js')
